extends layout

block content
  h1 $$$Gross... Movies

  table(id="movie-table" class="display")
    thead
      tr
        th movie_title
        th studio
        th year
        th box_office
        th picture
        th Editor
    tfoot
      tr
        th movie_title
        th studio
        th year
        th box_office
        th picture
        th Editor


  
  script(src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js')
  script(src='https://cdn.datatables.net/v/bs-3.3.6/jq-2.2.3/dt-1.10.12/datatables.min.js')
  script(src='/javascripts/jquery.confirm.min.js')

  script.
    $(document).ready(function() {

      $('#movie-table').DataTable( {
          "ajax": '/movies/api/json',
          "columns": [
            { "data": "movie_title" },
            { "data": "studio" },
            { "data": "year" },
            { "data": "box_office" },
            { "data": "picture" },
            { "data": null }],

          "lengthMenu": [[5, 10, 20, -1], [5, 10, 20, "All"]],
          "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
            var imgLink = aData['picture']; // if your JSON is 3D
            // var imgLink = aData[4]; // where 4 is the zero-origin column for 2D

            var imgTag = ''
            if(imgLink==null){
              imgTag = 'missing image'
            } else {

              imgTag = '<img src="/' + imgLink + '"/>';
            }

            $('td:eq(4)', nRow).html(imgTag); // where 4 is the zero-origin visible column in the HTML

            var editLink = aData['id'];

            var button_url = 'onclick ="' + "location.href='/movies/" + editLink + "';" + '"';
            var destroy_url = 'onclick ="' + "location.href='/movies/" + editLink + "/destroy';" + '"';

            var buttonTag = 
              '<button ' + button_url + 'type="button" class="btn btn-default"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit </button><button id="delete-button" type="button" class="btn btn-default confirm"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete</button>';
            

            $('td:eq(5)', nRow).html(buttonTag);


            return nRow;
          }


      });

    });

    $("#delete-button").confirm();
